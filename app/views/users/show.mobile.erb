<%= stylesheet_link_tag "timeline" %>
<%= stylesheet_link_tag "timeline_mobile" %>
<%= javascript_include_tag "timeline" %>

<script defer="defer">
$(function () {
    window.Timeline = window.Timeline || {};
    Timeline.currentData = <%= @eventsJson.html_safe %>;

    var shareHtmls = Timeline.shareHtmls = [];
    <% @events.each_with_index do |event, i| %>
        shareHtmls[<%= i %>] = '<%=escape_javascript(render :partial => "events/share", :locals => { :event => event, :size => :medium }) %>';
    <% end %>

    var eventHtmls = Timeline.eventHtmls = [];
    <% @events.each_with_index do |event, i| %>
        <% showSignUpButton = event.start > DateTime.now && !event.attending?(@user) %>
        eventHtmls[<%= i %>] = '<%=escape_javascript(render :partial => "events/event", :locals => { :event => event, :description => :medium, :sign_up_button => showSignUpButton }) %>';
    <% end %>

    Timeline.buildTimeline();
});
</script>

<div class="row-fluid timeline-header">
    <div class="span9">
        <% if can? :see_events, @user %>
            <div class="row-fluid tlh-toprow">
                <div class ="span3">
                    <div><%= image_tag @user.avatar.url(:profile), :class => "tlh-avatar" %></div>
                    </div>
                <div class="span9">
                    <div>
                        <div class="pull-left tlh-username">
                            <h1 class="h1-override"><%= @user.name %></h1>
                        </div> 
                        <div class="clear">
                            <%= render :partial => "skills/strip", :locals => { :entity => @user, :size => "small" } %>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span3">&nbsp;</div>
            </div>
            <div class="row-fluid tlh-bottomrow">
                <!--<div class="span3">
                    <div class="tlh-followercount-align">
                        <span class="tlh-followercount"><%= @nFollowers %></span> followers
                    </div>
                </div>-->
                    <% if @user.neighborhood %>
                        <div><h4>volunteers in <%= link_to(@user.neighborhood.name, (events_url.concat("/in/").concat(@user.neighborhood.name))) %></h4></div>
                    <% end %>
                    <% if @user.type == "Org" %>
                        <div><p>Visit <%= @user.name%> at <%= link_to(@user.website, "http://" + @user.website) %></p></div>
                    <% end %>

                    <div class="row-fluid bold">
                        <div class = "t1h-stats">
                            <h4>hours: <%= @nHoursVolunteered %></h4>
                            <h4>created: <%= @nEventsCreated %></h4>
                            <h4>upcoming: <%= @nEventsComingUp %></h4>
                            <h4>past: <%= @nEventsInPast %></h4>
                        </div>
                    </div>
            </div>
        <% else %>
            <%= @user.name %> does not have a public profile. <!--If you know <%=@user.name %>, send a Flash Team request. -->
        <% end %>
        <div id="upcoming_content">
        <% if(@upcoming_events.count == 0) %>
            <%=@user.name%> has no upcoming events. 
        <% else %>
            <%= render(:partial => "events/event", :collection => @upcoming_events, :as => :event, :locals => { :show_links => false, :description => :medium }) %>
        <% end %>
    </div>
    </div>
    <div class="span3 list_spacing bold" style="margin-top:48px">
        <ul class="unstyled">
            <%if current_user != @user%>
                <li><%= link_to "GIVE PROPS", new_prop_url(@user) %></li>
            <%end%>

            <li><%= link_to "UPCOMING EVENTS", events_user_url(@user) +"#upcoming" %></li>
            <li><%= link_to "RECOMMENDED EVENTS", events_user_url(@user) + "#recommended" %></li>
            <% if can? :create, Event %>
                <li><%= link_to "CREATE NEW EVENT", new_event_url %></p>
            <% end %>  
        </ul>
    </div>
</div>